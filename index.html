<html>
<head>
<title>Diachron DB</title>
<meta charset="UTF-8">
<link href="/psi-fff.ico" rel="shortcut icon" type="image/x-icon">
<link rel="shortcut icon" href="/psi-white.ico" id="psi-white">
<style>
@charset "UTF-8";
/* @import 'https://www.matthewmorrone.com/reset.css'; */
/* @import 'style.css'; */
@import 'https://www.matthewmorrone.com/jquery.ui.css';
@import 'https://www.matthewmorrone.com/font-awesome.min.css';
@import 'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css';

header {
    min-width: 800px;
    text-align: center;
}
table {
    float: left;
}
content div {
    display: flex;
    align-items: center;
    justify-content: center;
}
.inverted {
    filter: 100%;
    background-color: black;
}
</style>
<script src="https://matthewmorrone.com/prefixfree.js"></script>
<script src="https://matthewmorrone.com/jquery.js"></script>
<script src="https://matthewmorrone.com/jquery.ui.js"></script>
<script src="https://matthewmorrone.com/jquery.helpers.js"></script>
<script src="https://matthewmorrone.com/starch.js"></script>
<script>
let log = console.log.bind(console)

let url = `mysql.php`

function arrayToSelect(options, id) {
    let result = `<input type=text name=${id} list=${id} />`;
    result += `<datalist id='${id}'>`;
    Object.keys(options).forEach((key, index) => {
        result += `<option>${options[key]}</option>`
    });
    result += "</datalist>";
    return result
}
function submitData() {
    let submit = {
        mode: "insert",
        table: "pairs",
        data: {
            source_ipa:  $("[name=source_ipa]").val(),
            target_ipa:  $("[name=target_ipa]").val(),
            source_lang: $("[name=source_lang]").val(),
            target_lang: $("[name=target_lang]").val(),
        }
    };
    if (!submit.data.source_ipa 
     || !submit.data.target_ipa 
     || !submit.data.source_lang 
     || !submit.data.target_lang) {
        return
    }

    console.log(submit)
    $.post(url, submit, function(data) {
        console.log(data)
    })
}
function addFunctionality() {
    $("input").on("change keyup", function() { 
        $("table tbody tr").show();
        let val = $(this).val();
        if (!val) return;
        let col = $(this).parent().parent().index();
        $("table tbody tr").each(function() {
            if (!$(this).find("td").eq(col).text().includes(val)) {
                $(this).hide()
            }
        })
    })
}
$(function () {
    // loadpage(`mysql.php`, { debug: true, mode: "insert", table: "phones", phone: "ar" })
    // loadpage(`mysql.php`, { debug: true, mode: "insert", table: "languages", language: "Bleurgh" })
    
    $.post(url, { mode: "query" }, function(data) {
        $(`content`).html($(`content`).html()+`<div>${data}</div>`)
        $("table thead").append(`<tr>
            <td><span id='source_ipa_span'></span></td>
            <td><span id='target_ipa_span'></span></td>
            <td><span id='source_lang_span'></span></td>
            <td><span id='target_lang_span'></span></td>
        </tr>`)
        $.post(url, { mode: "phones" }, function(data) {
            data = JSON.parse(data)
            $("#source_ipa_span").html(arrayToSelect(data, "source_ipa"))
            $("#target_ipa_span").html(arrayToSelect(data, "target_ipa"))
            addFunctionality()
        }, "text")
        $.post(url, { mode: "languages" }, function(data) {
            data = JSON.parse(data)
            $("#source_lang_span").html(arrayToSelect(data, "source_lang"))
            $("#target_lang_span").html(arrayToSelect(data, "target_lang"))
            addFunctionality()

        }, "text")
    }, "text")

    $(document).keyup(function(e) {
        if (e.which === 13) {
            submitData()
        }
    })
})
</script>
</head>
<body>
<div id="wrapper">
    <header>
        <h1>Diachron DB</h1>
    </header>
    <content>

    </content>
    <footer>

    </footer>
    <script>
        log(window.location)
    </script>
</body>
</html>